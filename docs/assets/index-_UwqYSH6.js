var At=Object.defineProperty;var St=(t,e,n)=>e in t?At(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(St(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();class bt extends Error{}function Rt(t,e="assertion failed"){if(!t)throw new bt(e)}function Et(t,e="expected a defined value"){return Rt(t!=null,e),t}function Bt(t,e,n){return Math.min(Math.max(t,n),e)}function E(t){return[...Array(t).keys()]}function Ct(t){return t.filter((e,n)=>n%2===0)}function Dt(t){return t.filter((e,n)=>n%2!==0)}const dt=t=>`${t}`;function mt(t,e=dt){return t.map(n=>"("+n.map(e).join(" ")+")").join("")}function Pt(t,e=dt){const n=[],s=new Set;for(const r of t){if(r.length<2)continue;const o=Math.min(...r),i=r.indexOf(o),u=r.length,c=[];for(let l=0;l<u;l++){const z=r[(i+l)%u];if(s.has(z))throw new Error(`${e(z)} appears multiple times in ${mt(t,e)}`);s.add(z),c.push(r[(i+l)%u])}n.push(c)}return n.sort((r,o)=>r[0]-o[0]),n}function v(t){return t.map(e=>[...e].reverse()).reverse()}function pt(t){const e=t.length;return e<=2?[]:e%2===0?[Ct(t),Dt(t)]:[t.map((n,s)=>t[s*2%e])]}function y(t){return t.flatMap(pt)}function Ut(t){return E(t.length).map(e=>t.indexOf(e))}function Ot(...t){const e=t[0].length;let n=E(e);for(const s of t){const r=E(e);s.forEach((o,i)=>r[o]=n[i]),n=r}return n}function B(t){const e=t.length,n=[],s=new Set;for(let r=0;r<e;r++){if(t[r]===r||s.has(r))continue;let o=r;const i=[];do s.add(o),i.push(o),o=t[o];while(o!==r);n.push(i)}return n}function It(t){return K(B(t))}function Wt(t,e){const n=E(e);for(const s of t){const r=s.length;for(let o=0;o<r;o++)n[s[o]]=s[(o+1)%r]}return n}function K(t){const e=[];for(const n of t)for(let s=n.length-1;s>0;s--)e.push([n[0],n[s]]);return e}function wt(t,e){const n=E(e);for(const[s,r]of t){const o=n[s];n[s]=n[r],n[r]=o}return n}function kt(t){return B(wt(t,Math.max(...t.flat())+1))}const qt=[3,2,0,1],Tt=[3,0,1,2],$t=[1,3,0,2];function Nt(t){if(t.length!==4)throw new Error("not an element of S4");const e=K(B(t)).reverse(),n=[];for(const[s,r]of e){const o=Math.min(s,r),i=Math.max(s,r);if(o===0&&i===1)n.push(0);else if(o===0&&i===2)n.push(1);else if(o===0&&i===3)n.push(2);else if(o===1&&i===2)n.push(3);else if(o===1&&i===3)n.push(4);else if(o===2&&i===3)n.push(5);else throw new Error(`bad transposition: (${s} ${r})`)}return n}const Ht=[[2,3,0,1,5,4],[4,5,3,2,0,1],[1,0,4,5,2,3],[1,0,5,4,3,2],[5,4,3,2,1,0],[3,2,1,0,5,4]];function Kt(t){const e="FBUDLR";return B(t).map(n=>"("+n.map(s=>e.charAt(s)).join(" ")+")").join("")}const b=-1,A=0,a=1,M=2,p=3,g=4,w=5,L=6,x=7,F=8,P=0,U=2,O=6,I=8,W=18,k=20,q=24,T=26,Y=1,G=3,Q=5,X=7,J=9,V=11,Z=15,_=17,j=19,tt=21,et=23,nt=25,rt=[[P,U,I,O],[Y,Q,X,G]],st=[[W,q,T,k],[j,tt,nt,et]],ot=[[P,W,k,U],[Y,J,j,V]],it=[[O,I,T,q],[X,_,nt,Z]],ct=[[P,O,q,W],[J,G,Z,tt]],at=[[U,k,T,I],[V,et,_,Q]],Yt=v(rt),Gt=v(st),Qt=v(ot),Xt=v(it),Jt=v(ct),Vt=v(at),Zt=y(rt),_t=y(st),jt=y(ot),te=y(it),ee=y(ct),ne=y(at),xt=[p,g,A,x,w,a,L,F,M,F,M,L,g,b,p,w,a,x,a,x,w,M,L,F,A,p,g];class C{constructor(e){this.data=e}static initial(){return new C([...xt])}}const re=Object.freeze(Object.defineProperty({__proto__:null,B:st,B2:_t,BD:nt,BDL:q,BDR:T,BL:tt,BR:et,BU:j,BUL:W,BUR:k,Bi:Gt,Cb:w,Cc:L,Cg:A,Ck:a,Co:g,Cp:F,Cr:x,Cw:M,Cy:p,D:it,D2:te,DL:Z,DR:_,Di:Xt,F:rt,F2:Zt,FD:X,FDL:O,FDR:I,FL:G,FR:Q,FU:Y,FUL:P,FUR:U,Fi:Yt,L:ct,L2:ee,Li:Jt,Molecube:C,R:at,R2:ne,Ri:Vt,S4x:qt,S4y:Tt,S4z:$t,S6:Ht,U:ot,U2:jt,UL:J,UR:V,Ui:Qt,catperm:Ot,dblcycle:pt,dblmove:y,fmtmove:mt,formatS6:Kt,initial:xt,invmove:v,invperm:Ut,move2perm:Wt,move2tr:K,normmove:Pt,perm2S4Flips:Nt,perm2move:B,perm2tr:It,tr2move:kt,tr2perm:wt,xx:b},Symbol.toStringTag,{value:"Module"})),vt={x:1,y:0,z:0,w:0},yt={x:0,y:1,z:0,w:0},se={x:0,y:0,z:1,w:0},ut={x:0,y:0,z:0,w:1},oe={x:0,y:0,z:0,w:0},lt={x:0,y:0,z:0,w:1};function R(t,e,n){return{x:t,y:e,z:n,w:1}}function S(...t){return t.reduce((e,n)=>({x:e.x+n.x,y:e.y+n.y,z:e.z+n.z,w:e.w+n.w}),oe)}function N(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z,w:t.w-e.w}}function h({x:t,y:e,z:n,w:s},r){return{x:t*r,y:e*r,z:n*r,w:s*r}}function zt({x:t,y:e,z:n,w:s},r){return{x:t/r,y:e/r,z:n/r,w:s/r}}function D(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w}function ie(t){return Math.sqrt(D(t,t))}function ce(t){return zt(t,ie(t))}const ae={x:vt,y:yt,z:se,w:ut};function ue(t,e,n){return{x:{x:1,y:0,z:0,w:0},y:{x:0,y:1,z:0,w:0},z:{x:0,y:0,z:1,w:0},w:{x:t,y:e,z:n,w:1}}}function Mt(t){return{x:vt,y:{x:0,y:Math.cos(t),z:Math.sin(t),w:0},z:{x:0,y:-Math.sin(t),z:Math.cos(t),w:0},w:ut}}function gt(t){return{x:{x:Math.cos(t),y:0,z:-Math.sin(t),w:0},y:yt,z:{x:Math.sin(t),y:0,z:Math.cos(t),w:0},w:ut}}function d(t,{x:e,y:n,z:s,w:r}){return S(h(t.x,e),h(t.y,n),h(t.z,s),h(t.w,r))}function Lt(...t){return t.reduce((e,n)=>({x:d(e,n.x),y:d(e,n.y),z:d(e,n.z),w:d(e,n.w)}),ae)}const ft={[w]:"#00f",[L]:"#0ff",[A]:"#080",[a]:"#000",[g]:"#f80",[F]:"#f0f",[x]:"#f00",[M]:"#fff",[p]:"#ff0",[b]:"#888"};function le(t){const e=[],n=[],s=[];for(const r of t)switch(r.t){case"sphere":e.push(r),n.push(r);break;case"line":s.push(r);break}for(const r of s){let o=[r];for(const i of n)o=o.flatMap(u=>fe(u,i));e.push(...o)}return e}function fe(t,e){const n=[],[s,r]=he(t,e)??[-1,-1];return 0<s&&n.push(ht(t,0,Math.min(1,s))),r<1&&n.push(ht(t,Math.max(0,r),1)),n}function he(t,e){const n=N(t.end,t.start),s=N(t.start,e.at),r=e.radius,o=D(n,n),i=2*D(n,s),u=D(s,s)-r*r,c=i*i-4*o*u;if(c<=0)return;const l=(-i+Math.sqrt(c))/(2*o),z=(-i-Math.sqrt(c))/(2*o);return[Math.min(l,z),Math.max(l,z)]}function ht(t,e,n){const{start:s,end:r}=t,o=N(r,s);return{...t,start:S(s,h(o,e)),end:S(s,h(o,n))}}function de(t,e){switch(e.t){case"line":return{...e,start:d(t,e.start),end:d(t,e.end)};case"sphere":return{...e,at:d(t,e.at)}}}function me(t){switch(t.t){case"line":return zt(S(t.start,t.end),2).z;case"sphere":return t.at.z}}function pe(t,e){switch(e.t){case"line":t.strokeStyle=ft[e.color??a],t.beginPath(),t.moveTo(-e.start.x/e.start.z,-e.start.y/e.start.z),t.lineTo(-e.end.x/e.end.z,-e.end.y/e.end.z),t.stroke();break;case"sphere":{const n=-1/e.at.z;t.strokeStyle="#000",t.fillStyle=ft[e.color??b],t.beginPath(),t.ellipse(n*e.at.x,n*e.at.y,n*e.radius,n*e.radius,0,0,2*Math.PI),t.fill(),t.stroke(),t.restore();break}}}const f=class f extends HTMLElement{constructor(){super();m(this,"cube");m(this,"camera");m(this,"canvas");this.cube=C.initial(),this.camera={dist:10,az:Math.PI/4,alt:Math.PI/5},this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width","1"),this.canvas.setAttribute("height","1"),this.appendChild(this.canvas),this.addEventListener("mousedown",this.onMouseDown.bind(this)),document.addEventListener("mousemove",this.onMouseMove.bind(this)),document.addEventListener("mouseup",this.onMouseUp.bind(this))}connectedCallback(){const n=this.canvas.getBoundingClientRect();this.canvas.setAttribute("width",`${n.width}`),this.canvas.setAttribute("height",`${n.height}`),this.requestAnimationFrame()}frame(){const n=Et(this.canvas.getContext("2d",{alpha:!1})),{width:s,height:r}=this.canvas.getBoundingClientRect();n.resetTransform(),n.fillStyle="#fff",n.fillRect(0,0,s,r),n.lineWidth=.005,n.translate(s/2,r/2),n.scale(r*2,-r*2);const o=Lt(ue(0,0,-this.camera.dist),Mt(this.camera.alt),gt(-this.camera.az)),i=[];for(const c of this.children)c instanceof $&&i.push(...c.render().map(l=>de(o,l)));const u=[];for(const c of le(i))u.push([me(c),c]);u.sort((c,l)=>c[0]-l[0]);for(const[,c]of u)pe(n,c)}requestAnimationFrame(){window.requestAnimationFrame(this.frame.bind(this))}onMouseDown(n){f.activeWidget===void 0&&(f.activeWidget=this,n.preventDefault())}onMouseMove(n){if(f.activeWidget===this){const{width:s,height:r}=this.canvas.getBoundingClientRect();n.buttons&1?(this.camera.az-=Math.PI*n.movementX/s,this.camera.alt+=Math.PI*n.movementY/r,this.camera.alt=Bt(-Math.PI/2,Math.PI/2,this.camera.alt),this.requestAnimationFrame()):f.activeWidget=void 0}}onMouseUp(){f.activeWidget===this&&(f.activeWidget=void 0,this.requestAnimationFrame())}};m(f,"activeWidget");let H=f;class $ extends HTMLElement{}const Ft={B:w,C:L,G:A,K:a,O:g,P:F,R:x,W:M,Y:p,x:b};class we extends ${constructor(){super();m(this,"cube");this.cube=C.initial()}connectedCallback(){const n=this.getAttribute("data-init");if(n!==null){let s=0;for(let r=0;r<n.length&&s<27;r++){const o=Ft[n.charAt(r)];o!==void 0&&(this.cube.data[s++]=o)}}}render(){const n=[];for(let s=0;s<3;s++)for(let r=0;r<3;r++)for(let o=0;o<3;o++)s===1&&r===1&&o===1||n.push({t:"sphere",at:R(-1+o,1-r,1-s),radius:.5,color:this.cube.data[s*9+r*3+o]});return n}}class xe extends ${render(){const e=ye(this.getAttribute("data-dir"));if(e===null)return[];const n=h(ce(e),3);return[{t:"line",start:S(lt,n),end:S(lt,h(n,-1)),color:Ft[this.getAttribute("data-color")??"x"]??b}]}}class ve extends ${constructor(){super();m(this,"points");const n=[R(-1,-1,-1),R(1,-1,1),R(-1,1,1),R(1,1,-1)],s=Lt(Mt(Math.atan(Math.SQRT2)),gt(Math.PI/4));this.points=n.map(r=>d(s,r))}render(){const[n,s,r,o]=this.points;return[{t:"sphere",color:x,at:n,radius:.2},{t:"sphere",color:p,at:s,radius:.2},{t:"sphere",color:A,at:r,radius:.2},{t:"sphere",color:w,at:o,radius:.2},{t:"line",color:a,start:n,end:s},{t:"line",color:a,start:n,end:r},{t:"line",color:a,start:n,end:o},{t:"line",color:a,start:s,end:r},{t:"line",color:a,start:s,end:o},{t:"line",color:a,start:r,end:o}]}}function ye(t){if(t===null)return null;const e=t.match(/^ *([-0-9.]+) +([-0-9.]+) +([-0-9.]+) *$/);return e===null?null:{x:Number.parseFloat(e[1]),y:Number.parseFloat(e[2]),z:Number.parseFloat(e[3]),w:0}}function ze(){customElements.define("widget-cube",we),customElements.define("widget-axis",xe),customElements.define("widget-tetrahedron",ve),customElements.define("widget-canvas",H)}window.m=re;ze();
